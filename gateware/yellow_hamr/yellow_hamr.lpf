// =============================================================================
// Yellow Hamr - Pin Constraints (matching Logic Hamr configuration)
// =============================================================================

// =============================================================================
// Clock Constraints
// =============================================================================
// CLK_25MHz is deliberately unused â€” single clock domain design using sig_7M
// only, matching Yellowstone's no-oscillator architecture. No FREQUENCY
// constraint for CLK_25MHz prevents nextpnr from creating a second clock
// domain and analyzing false cross-domain timing violations.
FREQUENCY PORT "sig_7M" 7.16 MHz;

// =============================================================================
// Apple II Control (directly from Logic Hamr)
// =============================================================================
LOCATE COMP "sig_7M" SITE "A9";
IOBUF PORT "sig_7M" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;

LOCATE COMP "Q3" SITE "B10";
IOBUF PORT "Q3" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;

LOCATE COMP "uSync" SITE "B11";
IOBUF PORT "uSync" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;

LOCATE COMP "RDY" SITE "E10";
IOBUF PORT "RDY" IO_TYPE=LVCMOS33 PULLMODE=NONE;

LOCATE COMP "nIRQ" SITE "B8";
IOBUF PORT "nIRQ" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "nNMI" SITE "A7";
IOBUF PORT "nNMI" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "nRES" SITE "A8";
IOBUF PORT "nRES" IO_TYPE=LVCMOS33 OPENDRAIN=ON SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "DMA_IN" SITE "C6";
IOBUF PORT "DMA_IN" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "DMA_OUT" SITE "C10";
IOBUF PORT "DMA_OUT" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "nDMA" SITE "B6";
IOBUF PORT "nDMA" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "nINH" SITE "B9";
IOBUF PORT "nINH" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "nDEVICE_SELECT" SITE "D16";
IOBUF PORT "nDEVICE_SELECT" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "INT_IN" SITE "A6";
IOBUF PORT "INT_IN" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "INT_OUT" SITE "D9";
IOBUF PORT "INT_OUT" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "R_nW" SITE "D10";
IOBUF PORT "R_nW" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

// =============================================================================
// Clock
// =============================================================================
LOCATE COMP "CLK_25MHz" SITE "G3";
IOBUF PORT "CLK_25MHz" IO_TYPE=LVCMOS33 PULLMODE=NONE;

LOCATE COMP "PHI0" SITE "A11";
IOBUF PORT "PHI0" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;

LOCATE COMP "PHI1" SITE "A10";
IOBUF PORT "PHI1" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;

// =============================================================================
// Apple II Address Bus (A0-A11 only, using array notation)
// =============================================================================
LOCATE COMP "addr[0]" SITE "B19";
IOBUF PORT "addr[0]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[1]" SITE "A18";
IOBUF PORT "addr[1]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[2]" SITE "B18";
IOBUF PORT "addr[2]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[3]" SITE "A17";
IOBUF PORT "addr[3]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[4]" SITE "C17";
IOBUF PORT "addr[4]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[5]" SITE "A16";
IOBUF PORT "addr[5]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[6]" SITE "B16";
IOBUF PORT "addr[6]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[7]" SITE "B17";
IOBUF PORT "addr[7]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[8]" SITE "C16";
IOBUF PORT "addr[8]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[9]" SITE "E15";
IOBUF PORT "addr[9]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[10]" SITE "C15";
IOBUF PORT "addr[10]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;
LOCATE COMP "addr[11]" SITE "D15";
IOBUF PORT "addr[11]" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

// =============================================================================
// Apple II Data Bus (individual pins like Logic Hamr)
// =============================================================================
// PULLMODE=NONE: No pull resistors. With FPGA high-Z, pins float.
LOCATE COMP "D0" SITE "A15";
IOBUF PORT "D0" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "D1" SITE "B15";
IOBUF PORT "D1" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "D2" SITE "A14";
IOBUF PORT "D2" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "D3" SITE "C14";
IOBUF PORT "D3" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "D4" SITE "A13";
IOBUF PORT "D4" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "D5" SITE "B13";
IOBUF PORT "D5" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "D6" SITE "A12";
IOBUF PORT "D6" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "D7" SITE "B12";
IOBUF PORT "D7" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;

// =============================================================================
// Apple II I/O Select
// =============================================================================
LOCATE COMP "nI_O_SELECT" SITE "A19";
IOBUF PORT "nI_O_SELECT" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

LOCATE COMP "nI_O_STROBE" SITE "C11";
IOBUF PORT "nI_O_STROBE" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;

// =============================================================================
// GPIO Header - SmartPort Drive Interface (GPIO1-8)
// =============================================================================
LOCATE COMP "GPIO1" SITE "L1";
IOBUF PORT "GPIO1" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "GPIO2" SITE "K1";
IOBUF PORT "GPIO2" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "GPIO3" SITE "J1";
IOBUF PORT "GPIO3" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "GPIO4" SITE "H1";
IOBUF PORT "GPIO4" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "GPIO5" SITE "F2";
IOBUF PORT "GPIO5" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=NONE;
LOCATE COMP "GPIO6" SITE "E2";
IOBUF PORT "GPIO6" IO_TYPE=LVCMOS33 PULLMODE=DOWN;  // rddata from ESP32 - pull LOW for idle (match Liron, avoid spurious falling edges)
LOCATE COMP "GPIO7" SITE "E1";
IOBUF PORT "GPIO7" IO_TYPE=LVCMOS33 PULLMODE=UP;  // sense/ACK from ESP32 - pull HIGH for idle (ACK deasserted)
LOCATE COMP "GPIO8" SITE "D1";
IOBUF PORT "GPIO8" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=SLOW PULLMODE=UP;  // _enbl1 active-low - pull HIGH for idle during FPGA config

// =============================================================================
// GPIO Header - Additional Outputs (GPIO9-12)
// =============================================================================
// GPIO9:  _wrreq (write request, active low)
// GPIO10: _enbl2 (drive 2 enable, active low)
// GPIO11: _underrun debug (LOW = write serializer starved)
// GPIO12: Level shifter OE (active-low, controls D[7:0] buffer direction)
LOCATE COMP "GPIO9" SITE "C1";
IOBUF PORT "GPIO9" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=FAST PULLMODE=UP;  // _wrreq active-low - pull HIGH for idle during FPGA config
LOCATE COMP "GPIO10" SITE "A4";
IOBUF PORT "GPIO10" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=FAST PULLMODE=UP;  // _enbl2 active-low - pull HIGH for idle during FPGA config
LOCATE COMP "GPIO11" SITE "B5";
IOBUF PORT "GPIO11" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=FAST PULLMODE=NONE;
LOCATE COMP "GPIO12" SITE "A5";
IOBUF PORT "GPIO12" IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=FAST PULLMODE=NONE;
